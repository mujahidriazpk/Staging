(()=>{var a,n;a=jQuery,n={init:function(){this.accountSettings.init()},accountSettings:{init:function(){this.toggleBusinessTypeField(),this.updateStates(),a("#dokan-mangopay-account-disconnect").click(this.disconnect),a("#dokan-mangopay-account-connect").click(this.signUp),a("#dokan-mangopay-tabs li").click(this.toggle),a("#dokan-mangopay-user-status, #dokan-mangopay-business-type").change(this.toggleBusinessTypeField),a("#dokan-mangopay-country").change(this.updateStates)},toggle:function(){a("#dokan-mangopay-tabs li").each((function(){a(this).data("id").split("|").forEach((function(n){a("#dokan-mangopay-".concat(n)).addClass("hidden")})),a(this).removeClass("active")})),a(this).data("id").split("|").forEach((function(n){a("#dokan-mangopay-".concat(n)).removeClass("hidden")})),a(this).addClass("active"),a(this).hasClass("dokan-mp-bank")?n.bankAccount.init():a(this).hasClass("dokan-mp-verification")&&(n.kyc.init(),n.ubo.init())},signUp:function(o){o.preventDefault(),n.accountSettings.showProcessing(),a("#dokan-mangopay-account-connect").hide(),a("#dokan-mangopay-account-processing").show();var t={action:"dokan_mangopay_signup",user_id:a(this).data("user"),date_of_birth:a("#dokan-mangopay-user-birthday").val(),nationality:a("#dokan-mangopay-user-nationality").val(),person_type:a("#dokan-mangopay-user-status").val(),business_type:a("#dokan-mangopay-business-type").val(),company_number:a("#dokan-mangopay-company-number").val(),address1:a("#dokan-mangopay-address1").val(),address2:a("#dokan-mangopay-address2").val(),country:a("#dokan-mangopay-country").val(),postcode:a("#dokan-mangopay-postcode").val(),city:a("#dokan-mangopay-city").val(),state:a("#dokan-mangopay-state").val(),_wpnonce:a("#payment-form #_wpnonce").val()};wp.ajax.send({data:t,success:function(o){a("#dokan-mangopay-account-connect").hide(),a("#dokan-mangopay-account .action-notice").removeClass("hidden").removeClass("dokan-alert-danger").addClass("dokan-alert-success").html(o),a("form#payment-form").submit(),setTimeout((function(){window.location.reload(!0)}),500),a("#dokan-mangopay-account-processing").hide(),n.accountSettings.hideProcessing()},error:function(o){a("#dokan-mangopay-account .action-notice").removeClass("hidden").removeClass("dokan-alert-success").addClass("dokan-alert-danger").html(o),a("html, body").animate({scrollTop:a("#dokan-mangopay-account-notice").offset().top},500),a("#dokan-mangopay-account-processing").hide(),a("#dokan-mangopay-account-connect").show(),n.accountSettings.hideProcessing()}})},disconnect:function(o){o.preventDefault(),n.accountSettings.showProcessing(),a("#dokan-mangopay-account-processing").show(),a("#dokan-mangopay-account-disconnect").hide(),wp.ajax.send({data:{action:"dokan_mangopay_disconnect_vendor",user_id:a(this).data("user"),_wpnonce:a("#payment-form #_wpnonce").val()},success:function(o){a("#dokan-mangopay-account .action-notice").removeClass("hidden").addClass("dokan-alert-success").html(o),setTimeout(window.location.reload(!0),200),a("#dokan-mangopay-account-processing").hide(),n.accountSettings.hideProcessing()},error:function(o){a("#dokan-mangopay-account .action-notice").addClass("dokan-alert-danger").html(o),a("#dokan-mangopay-account-processing").hide(),a("#dokan-mangopay-account-disconnect").show(),n.accountSettings.hideProcessing()}})},toggleBusinessTypeField:function(){"LEGAL"===a("#dokan-mangopay-user-status").val()?("hidden"!==a("#dokan-mangopay-business-type").attr("type")&&a("#dokan-mangopay-business-type").closest("p").removeClass("hidden"),"BUSINESS"===a("#dokan-mangopay-business-type").val()?a("#dokan-mangopay-company-number").closest("p").removeClass("hidden"):a("#dokan-mangopay-company-number").closest("p").addClass("hidden"),a("#dokan-mangopay-account .dokan-mp-hq-address").each((function(n,o){var t=a(o).closest("p").find("label");t.find("abbr").length||t.append('<abbr class="required" title="required">*</abbr>'),t.find("span").remove()}))):(a("#dokan-mangopay-business-type").closest("p").addClass("hidden"),a("#dokan-mangopay-company-number").closest("p").addClass("hidden"),a("#dokan-mangopay-account .dokan-mp-hq-address").each((function(n,o){var t=a(o).closest("p").find("label");t.find("abbr").remove(),t.find("span").length||t.append('<span class="optional">(optional)</span>')})))},updateStates:function(){n.accountSettings.showProcessing(),a("#dokan-mangopay-state").val(""),wp.ajax.send({data:{action:"dokan_mangopay_get_country_wise_states",country:a("#dokan-mangopay-country").val(),_wpnonce:a("#payment-form #_wpnonce").val()},success:function(o){if(!o||0===Object.keys(o).length)return a("#dokan-mangopay-state").closest("p").hide(),void n.accountSettings.hideProcessing();for(var t in a("#dokan-mangopay-state").closest("p").show(),options="<option>".concat(a(a("#dokan-mangopay-state option")[0]).html(),"</option>"),o)options+='<option value="'.concat(t,'">').concat(o[t],"</option>");a("#dokan-mangopay-state").html(options),n.accountSettings.hideProcessing()}})},showProcessing:function(){n.processing.show("#dokan-mangopay-account")},hideProcessing:function(){n.processing.hide("#dokan-mangopay-account")}},kyc:{init:function(){a("#dokan-mangopay-submit-kyc").off("click").click(this.submit),a("#dokan-mangopay-submit-kyc").attr("disabled","disabled"),a("#dokan-kyc-file").change((function(){a("#dokan-mangopay-kyc-notice").removeClass("dokan-alert-success dokan-alert-danger").html("").hide(),a("#dokan-mangopay-kyc-submit-container .upload-progress-status").hide(),a("#dokan-mangopay-kyc-notice").hide(),a("#dokan-mangopay-kyc-submit-container .progress-bar").css("width","0%"),a("#dokan-mangopay-kyc-submit-container .status").text("0%"),a(this).val()?a("#dokan-mangopay-submit-kyc").attr("disabled",!1):a("#dokan-mangopay-submit-kyc").attr("disabled","disabled")}))},submit:function(n){n.preventDefault(),a("#dokan-mangopay-kyc-notice").removeClass("dokan-alert-success dokan-alert-danger").html("").hide(),a("#dokan-mangopay-kyc-submit-container #dokan-mangopay-submit-kyc").hide(),a("#dokan-mangopay-kyc-submit-container #dokan-mangopay-submit-kyc-disabled").show(),a("#dokan-kyc-inputs").html("");var o=new FormData;o.append("action","dokan_mangopay_submit_kyc"),o.append("doc_type",a("#dokan-kyc-file-type").val()),o.append("_wpnonce",a("#payment-form #_wpnonce").val()),a.each(a("#dokan-kyc-file"),(function(n,t){a.each(t.files,(function(n,t){o.append("files[]",t),a("#dokan-kyc-inputs").append("<p> ".concat(n+1,". ").concat(t.name,"</p>"))}))})),a.ajax({url:dokanMangopay.ajaxurl,data:o,cache:!1,processData:!1,contentType:!1,type:"POST",success:function(n){a("#dokan-mangopay-kyc-notice").show(),n.success?a("#dokan-mangopay-kyc-notice").removeClass("dokan-alert-warning").addClass("dokan-alert-success").html(n.data):a("#dokan-mangopay-kyc-notice").removeClass("dokan-alert-success").addClass("dokan-alert-danger").html(n.data),a("#dokan-mangopay-kyc-submit-container #dokan-mangopay-submit-kyc").show(),a("#dokan-mangopay-kyc-submit-container #dokan-mangopay-submit-kyc-disabled").hide(),a("#dokan-kyc-file").val(""),a("#dokan-mangopay-submit-kyc").attr("disabled","disabled"),a("#dokan-mangopay-kyc-submit-container .upload-progress-status").hide()},xhr:function(){var n=a.ajaxSettings.xhr();return a("#dokan-kyc-file").val()?(n.upload&&(a("#dokan-mangopay-kyc-submit-container .upload-progress-status").show(),n.upload.addEventListener("progress",(function(n){var o=0,t=n.loaded||n.position,e=n.total;n.lengthComputable&&(o=Math.ceil(t/e*100)),a("#dokan-mangopay-kyc-submit-container .progress-bar").css("width",+o+"%"),a("#dokan-mangopay-kyc-submit-container .status").text(o+"%")}),!0)),n):n}})}},ubo:{init:function(){var n=this;a("#ubo_data").length>0&&this.renderForm(),a(document).on("click","#add_button_ubo_element, #update_button_ubo_element",n.submitUbo),a(document).on("click","#ubo_create_declaration_button",n.create),a(document).on("click","#ubo_askvalidation_button",n.askValidation),a(document).on("click","#ubo_add_button",n.resetForm),a(document).on("change","#dokan_mp_country",n.updateStates),a(document).on("click","#cancel_button_ubo_element",(function(){a("#form_add_ubo_element").hide(),n.enableAddBtn(),a("#ubo_askvalidation_button").show(),a("html, body").animate({scrollTop:a("#ubo_data").offset().top},500)})),a(document).on("click","[id^='show_ubo_elements_button_']",(function(){"show"==a(this).data("value")?(a(this).data("value","hide"),a(this).html('<span class="dashicons dashicons-remove"></span>')):(a(this).data("value","show"),a(this).html('<span class="dashicons dashicons-insert"></span>')),a("#tr_ubo_"+a(this).data("id")).toggle()})),a(document).on("click",'[id^="uboelementbutton_"]',n.prepareFieldData)},prepareFieldData:function(){var o=n.ubo;o.resetErrors();var t=a(this).data("uboelement");a("#ubo_element_id").val(t.Id),a("#dokan_mp_first_name").val(t.FirstName),a("#dokan_mp_last_name").val(t.LastName),a("#dokan_mp_address_line1").val(t.Address.AddressLine1),a("#dokan_mp_address_line2").val(t.Address.AddressLine2),a("#dokan_mp_city").val(t.Address.City),a("#dokan_mp_region").val(t.Address.Region),a("#dokan_mp_postal_code").val(t.Address.PostalCode),a("#dokan_mp_birthplace_city").val(t.Birthplace.City),a("#dokan_mp_country").val(t.Address.Country),a("#dokan_mp_nationality").val(t.Nationality),a("#dokan_mp_birthplace_country").val(t.Birthplace.Country),t.Address.Region||o.updateStates();var e=new Date(1e3*t.Birthday),c=e.getFullYear(),s=e.getMonth()+1,d=e.getDate();s<10&&(s="0"+s),d<10&&(d="0"+d),a("#dokan_mp_birthday").val(c+"-"+s+"-"+d),a("#add_button_ubo_element").hide(),a("#ubo_askvalidation_button").hide(),a("#ubo_add_button").hide(),a("#update_button_ubo_element").show(),a("#form_add_ubo_element").show()},askValidation:function(){var o=n.ubo;o.showProcessing();var t={action:"dokan_mangopay_ask_ubo_declaration",user_id:a("#ubo_mp_id").val(),ubo_declaration_id:a("#ubo_declaration_id").val(),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,t,(function(n){n.success?o.renderForm():(a("#ubo_create_error_div").html(n.data),a("#ubo_create_error_div").show()),o.hideProcessing()}))},create:function(){var o=n.ubo;o.showProcessing();var t={action:"dokan_mangopay_create_ubo",user_id:a("#ubo_mp_id").val(),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,t,(function(t){t.success?n.ubo.renderForm():(a("#ubo_create_error_div").html(t.data),a("#ubo_create_error_div").show()),o.hideProcessing()}))},getFields:function(){return["first_name","last_name","address_line1","address_line2","city","region","postal_code","country","nationality","birthday","birthplace_city","birthplace_country"]},updateStates:function(){n.ubo.showProcessing(),a("#dokan_mp_region").val(""),wp.ajax.send({data:{action:"dokan_mangopay_get_country_wise_states",country:a("#dokan_mp_country").val(),_wpnonce:a("#payment-form #_wpnonce").val()},success:function(o){if(!o||0===Object.keys(o).length)return a("#dokan_mp_region").closest("p").hide(),void n.ubo.hideProcessing();for(var t in a("#dokan_mp_region").closest("p").show(),options="<option>".concat(a(a("#dokan_mp_region option")[0]).html(),"</option>"),o)options+='<option value="'.concat(t,'">').concat(o[t],"</option>");a("#dokan_mp_region").html(options),n.ubo.hideProcessing()}})},resetForm:function(){n.ubo.getFields().forEach((function(n){a("#"+n).val("")})),a("#ubo_element_id").val(""),a("#form_add_ubo_element").show(),a("#ubo_add_button").hide(),a("#ubo_askvalidation_button").hide(),a("#add_button_ubo_element").show(),a("#update_button_ubo_element").hide(),n.ubo.updateStates()},resetErrors:function(){this.getFields().forEach((function(n){a("#"+n+"_error").hide()})),a("#ubo_list_errors").hide(),a("#ubo_create_error_div").html(""),a("#ubo_create_error_div").hide()},validateForm:function(){var n=!0;return this.getFields().forEach((function(o){("region"!==o||["US","MX","CA"].includes(a("#dokan_mp_country").val()))&&""==a("#dokan_mp_"+o).val()&&(a("#dokan_mp_"+o+"_error").show(),n=!1)})),n},renderForm:function(){n.ubo.showProcessing();var o={action:"dokan_mangopay_render_ubo_form",account_id:a("#ubo_data").data("mpid"),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,o,(function(o){a("#ubo_data").html(o.data),n.ubo.hideProcessing()}))},submitUbo:function(){var o=n.ubo;if(o.resetErrors(),!o.validateForm())return a("#ubo_list_errors").show(),void a("html, body").animate({scrollTop:a("#ubo_list_errors").offset().top},1e3);o.showProcessing(),a("#form_add_ubo_element").hide(),o.enableAddBtn(),a("#ubo_askvalidation_button").show();var t={action:"dokan_mangopay_add_ubo_element",account_id:a("#ubo_mp_id").val(),ubo_declaration_id:a("#ubo_declaration_id").val(),first_name:a("#dokan_mp_first_name").val(),last_name:a("#dokan_mp_last_name").val(),address_line1:a("#dokan_mp_address_line1").val(),address_line2:a("#dokan_mp_address_line2").val(),city:a("#dokan_mp_city").val(),region:a("#dokan_mp_region").val(),postal_code:a("#dokan_mp_postal_code").val(),country:a("#dokan_mp_country").val(),nationality:a("#dokan_mp_nationality").val(),date_of_birth:a("#dokan_mp_birthday").val(),birthplace_city:a("#dokan_mp_birthplace_city").val(),birthplace_country:a("#dokan_mp_birthplace_country").val(),ubo_element_id:a("#ubo_element_id").val(),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,t,(function(n){if(n.success){var t={action:"dokan_mangopay_render_ubo_form",account_id:a("#ubo_mp_id").val(),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,t,(function(n){a("#ubo_data").html(n.data);var o=a("#ubo_declaration_id").val();"show"==a("#show_ubo_elements_button_"+o).data("value")?(a("#show_ubo_elements_button_"+o).data("value","hide"),a("#show_ubo_elements_button_"+o).data('<span class="dashicons dashicons-remove"></span>')):(a("#show_ubo_elements_button_"+o).data("value","show"),a("#show_ubo_elements_button_"+o).html('<span class="dashicons dashicons-insert"></span>')),a("#tr_ubo_"+o).toggle(),a("html, body").animate({scrollTop:a("#tr_ubo_"+o).offset().top},500)}))}o.hideProcessing()}))},enableAddBtn:function(){var n=parseInt(a("#ubo_declaration_ubo_count_"+a("#ubo_declaration_id").val()).val());(!n||n<4)&&a("#ubo_add_button").show()},showProcessing:function(){n.processing.show("#dokan-mangopay-kyc")},hideProcessing:function(){n.processing.hide("#dokan-mangopay-kyc")}},bankAccount:{init:function(){var n=this;n.updateStates(),a(".dokan_mangopay_vendor_account_fields").hide(),a("#dokan-mangopay-vendor-acccount-type").val()&&a(".dokan_mangopay_vendor_account_fields."+a("#dokan-mangopay-vendor-acccount-type").val()+"_fields").show(),a("#dokan-mangopay-vendor-acccount-type").on("change",(function(n){a(".dokan_mangopay_vendor_account_fields").hide(),a(".dokan_mangopay_vendor_account_fields."+a(this).val()+"_fields").show()})),a("#dokan-mangopay-vendor-account-country").change(n.updateStates),a("#dokan-mp-bank-account-add-new").click(n.showForm),a("#dokan-mp-bank-account-cancel").click(n.hideForm),a("#dokan-mp-bank-account-create").click(n.create),a(document).on("click",'[id^="dokan-mp-active-bank-account-"]',n.activate)},create:function(o){o.preventDefault(),n.bankAccount.showProcessing(),a("#dokan-mp-bank-account-create").hide(),a("#dokan-mp-bank-account-creating").show();var t=a("#payment-form").serialize();t+="&action=dokan_mangopay_create_bank_account",wp.ajax.send({data:t,success:function(o){a("#dokan-mangopay-bank-account-notice").show(),a("#dokan-mangopay-bank-account-notice").removeClass("dokan-alert-danger").addClass("dokan-alert-success").html(o),a("html, body").animate({scrollTop:a("#dokan-mangopay-bank-account-notice").offset().top},500),a("#dokan-mp-bank-account-create").show(),a("#dokan-mp-bank-account-creating").hide(),setTimeout((function(){a("#dokan-mangopay-bank-account-notice").html("").hide()}),1e4),n.bankAccount.loadAccounts(),n.bankAccount.hideForm(),n.bankAccount.hideProcessing()},error:function(o){a("#dokan-mangopay-bank-account-notice").show(),a("#dokan-mangopay-bank-account-notice").removeClass("dokan-alert-success").addClass("dokan-alert-danger").html(o),a("html, body").animate({scrollTop:a("#dokan-mangopay-bank-account-notice").offset().top},500),a("#dokan-mp-bank-account-create").show(),a("#dokan-mp-bank-account-creating").hide(),setTimeout((function(){a("#dokan-mangopay-bank-account-notice").html("").hide()}),1e4),n.bankAccount.hideProcessing()}})},activate:function(o){o.preventDefault(),n.bankAccount.showProcessing();var t=a(this);t.html(dokanMangopay.processing+"..."),a('[id^="dokan-mp-active-bank-account-"]').each((function(){a(this).attr("disabled","disabled")}));var e={action:"dokan_mangopay_update_active_bank_account",user_id:t.data("user"),bank_account_id:t.data("bank-account"),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,e,(function(o){o.success?n.bankAccount.loadAccounts():(a("#dokan-mangopay-bank-account-list-notice").html(o.data).removeClass("hidden"),setTimeout((function(){a("#dokan-mangopay-bank-account-list-notice").html("").addClass("hidden")}),1e4),t.html(dokanMangopay.makeActive),a('[id^="dokan-mp-active-bank-account-"]').each((function(){a(this).removeAttr("disabled")}))),n.bankAccount.hideProcessing()}))},loadAccounts:function(){var n={action:"dokan_mangopay_get_bank_accounts",user_id:a("#dokan-mangopay-bank-account").data("user"),_wpnonce:a("#payment-form #_wpnonce").val()};a.post(dokanMangopay.ajaxurl,n,(function(n){n.success&&a("#dokan-mangopay-bank-account .dokan-mp-bank-accounts").html(n.data)}))},showForm:function(n){n.preventDefault(),a("#dokan-mp-bank-account-fields").removeClass("hidden"),a("#dokan-mp-bank-account-add-new").hide()},hideForm:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!1!==n&&n.preventDefault(),a("#dokan-mp-bank-account-fields").addClass("hidden"),a("#dokan-mp-bank-account-add-new").show()},updateStates:function(){n.bankAccount.showProcessing(),a("#dokan-mangopay-vendor-account-state").val(""),wp.ajax.send({data:{action:"dokan_mangopay_get_country_wise_states",country:a("#dokan-mangopay-vendor-account-country").val(),_wpnonce:a("#payment-form #_wpnonce").val()},success:function(o){if(!o||0===Object.keys(o).length)return a("#dokan-mangopay-vendor-account-state").closest("p").hide(),void n.bankAccount.hideProcessing();for(var t in a("#dokan-mangopay-vendor-account-state").closest("p").show(),options="<option>".concat(a(a("#dokan-mangopay-vendor-account-state option")[0]).html(),"</option>"),o)options+='<option value="'.concat(t,'">').concat(o[t],"</option>");a("#dokan-mangopay-vendor-account-state").html(options),n.bankAccount.hideProcessing()}})},showProcessing:function(){n.processing.show("#dokan-mangopay-bank-account")},hideProcessing:function(){n.processing.hide("#dokan-mangopay-bank-account")}},processing:{show:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".dokan-mangopay-container";a(n).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},hide:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".dokan-mangopay-container";a(n).unblock()}}},a(document).ready((function(){n.init()}))})();