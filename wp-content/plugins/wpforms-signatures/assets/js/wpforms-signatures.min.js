var WPFormsSignatures=window.WPFormsSignatures||function(h,t,e){"use strict";var r={config:{windowWidth:!1,pixelRatio:Math.max(t.devicePixelRatio||1,1),watching:!1,watchingRate:300},signatures:{},signaturesDisabled:[],getCanvas:function(t){var i=t.get(0);return i.width=i.offsetWidth*r.config.pixelRatio,i.height=i.offsetHeight*r.config.pixelRatio,i.getContext("2d").scale(r.config.pixelRatio,r.config.pixelRatio),i},cropCanvas:function(t){var i=h.createElement("canvas"),n=i.getContext("2d");i.width=t.width,i.height=t.height,n.drawImage(t,0,0);var e,a,r,s,g,o=i.width,u=i.height,c={x:[],y:[]},d=n.getImageData(0,0,i.width,i.height);for(a=0;a<u;a++)for(e=0;e<o;e++)g=4*(a*o+e),0<d.data[g+3]&&(c.x.push(e),c.y.push(a));return c.x.sort(function(t,i){return t-i}),c.y.sort(function(t,i){return t-i}),r=c.x.length-1,o=c.x[r]-c.x[0],u=c.y[r]-c.y[0],s=n.getImageData(c.x[0],c.y[0],o,u),i.width=o,i.height=u,n.putImageData(s,0,0),i.toDataURL()},watchSignatures:function(){if(r.signaturesDisabled.length<1)return clearInterval(r.config.watching),void(r.config.watching=!1);for(var t in r.signaturesDisabled){var i=e("#"+r.signaturesDisabled[t]);i.is(":hidden")||(r.signaturesDisabled.splice(t,1),n.loadSignature(i))}}},n={init:function(){e(h).on("wpformsReady",n.ready)},ready:function(){r.config.windowWidth=e(t).width(),n.loadSignatures(),e(h).on("click",".wpforms-signature-clear",function(t){t.preventDefault(),n.resetSignature(e(this).parent().find(".wpforms-signature-canvas"))}),e(t).resize(n.resetSignatures),0<r.signaturesDisabled.length&&(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate))},loadSignatures:function(){e(".wpforms-signature-canvas").each(function(){n.loadSignature(e(this))})},loadSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.attr("id"),e=r.getCanvas(t),a=t.data("color");t.is(":hidden")?r.signaturesDisabled.push(n):r.signatures[n]=new SignaturePad(e,{penColor:a,onEnd:function(){i.val(r.cropCanvas(e)).trigger("input change").valid()}})},resetSignatures:function(){r.config.windowWidth!==e(t).width()&&e(".wpforms-signature-canvas").each(function(){n.resetSignature(e(this))})},resetSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.attr("id");r.signatures[n]&&r.signatures[n].clear(),i.val("").trigger("input change"),t.is(":hidden")&&(-1===e.inArray(n,r.signaturesDisabled)&&r.signaturesDisabled.push(n),r.signatures[n]&&delete r.signatures[n],r.config.watching||(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)))}};return n}(document,window,jQuery);WPFormsSignatures.init();